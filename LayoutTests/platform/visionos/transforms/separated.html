<!DOCTYPE HTML><!-- webkit-test-runner [ CSSTransformStyleSeparatedEnabled=true useFlexibleViewport=false ] -->
<html>
<style>
    body { margin: 0; }
    #test {
        will-change: opacity;
    }

    .transformed {
      width: 200px;
      height: 200px;
      background: purple;
      translate: 0 0 20px;
      border-radius: 24px;
    }
    .separated {
      transform-style: separated;
    }
    .offscreen {
        margin-top: 2000px;
    }
</style>
<script src="../../../resources/ui-helper.js"></script>
<body>
<section id="test">
  <div class="transformed"></div>
  <div class="transformed separated"></div>
  <div class="transformed separated offscreen"></div>
</section>

<pre id="results"></pre>
<script>
if (window.testRunner) {
    testRunner.waitUntilDone();
    testRunner.dumpAsText();
}

window.onload = async function () {
    if (!window.internals)
        return;

    const testEl = document.getElementById('test');

    await UIHelper.ensureStablePresentationUpdate();
    results.textContent = await UIHelper.getCALayerTreeForCompositedElement(testEl);
    testEl.remove();

    testRunner.notifyDone();
};
</script>
</body>
</html>

